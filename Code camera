#include <Servo.h>

const int trigPin = 9;     // Pin trig du capteur ultrason
const int echoPin = 10;    // Pin echo du capteur ultrason
const int ledPin = 13;     // Pin de la LED
const int servoPin = 11;   // Pin du servo

Servo monServo;            // Crée un objet Servo

int angle = 0;             // Angle actuel du servo
int direction = 1;         // Direction du mouvement (1 = vers 180°, -1 = vers 0°)
bool objetDetecte = false; // État détection objet

void setup() {
  pinMode(trigPin, OUTPUT);
  pinMode(echoPin, INPUT);
  pinMode(ledPin, OUTPUT);
  
  monServo.attach(servoPin); 
  monServo.write(angle);   // Position initiale à 0°

  Serial.begin(9600);
}

void loop() {
  // Mesure la distance avec le capteur ultrason
  long duration, distance;
  
  digitalWrite(trigPin, LOW);
  delayMicroseconds(2);
  digitalWrite(trigPin, HIGH);
  delayMicroseconds(10);
  digitalWrite(trigPin, LOW);
  
  duration = pulseIn(echoPin, HIGH);
  distance = duration * 0.034 / 2;

  Serial.print("Distance: ");
  Serial.print(distance);
  Serial.println(" cm");

  // Vérifie la détection de l'objet
  if (distance < 100) {
    digitalWrite(ledPin, HIGH);   // Allume la LED
    objetDetecte = true;
    // On ne change PAS l'angle du servo ici, il reste à la dernière position
  } else {
    digitalWrite(ledPin, LOW);
    objetDetecte = false;
  }

  // Si aucun objet détecté, on fait bouger le servo
  if (!objetDetecte) {
    angle += direction;
    if (angle >= 180) { //change l'angle
      angle = 180;
      direction = -1;
    } else if (angle <= 0) {
      angle = 0;
      direction = 1;
    }
    monServo.write(angle);
    delay(15);
  } else {
    // Objet détecté, servo reste immobile à la position actuelle (angle)
    // Pas de changement d'angle, on ne fait rien ici
  }
}
