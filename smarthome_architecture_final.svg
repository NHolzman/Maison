<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1300" height="900" viewBox="0 0 1300 900">
<style>
    .box { fill:#f8f9fc; stroke:#2d3748; stroke-width:2.5; rx:16; }
    .title { font: bold 20px "Segoe UI", Arial; fill:#1a202c; }
    .label { font: 16px "Segoe UI", Arial; fill:#2d3748; }
    .sub { font: 13px "Segoe UI", Arial; fill:#4a5568; }
    .mqtt { fill:#f6ad55; stroke:#ed8936; }
    .ble { fill:#4299e1; stroke:#3182ce; }
    text { dominant-baseline:middle; text-anchor:middle; }
</style>
<defs>
<marker id="arrow" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto">
<path d="M0,0 L0,6 L9,3 z" fill="#4a5568"/>
</marker>
</defs>
 
  <!-- Titre -->
<rect x="20" y="15" width="1260" height="60" rx="12" fill="#1a202c"/>
<text x="650" y="45" class="title" fill="#fff">Système d'Alarme Connectée – Schéma Complet</text>
<text x="1080" y="45" fill="#fff" font-size="15">Légende : <tspan fill="#f6ad55">MQTT</tspan> / <tspan fill="#4299e1">BLE</tspan></text>
 
  <!-- MQTT Broker (central) -->
<ellipse cx="650" cy="130" rx="130" ry="60" class="mqtt" opacity="0.9"/>
<text x="650" y="125" fill="white" font-weight="bold" font-size="18">MQTT Broker</text>
<text x="650" y="145" fill="white" font-size="13">Serveur central (Node-RED / Mosquitto)</text>
 
  <!-- ESP32 (1) – Capteur de présence (HC-SR04 + Servo) -->
<rect x="50" y="200" width="360" height="240" class="box"/>
<text x="230" y="230" class="title">ESP32 #1 – Détection de présence</text>
<!-- Icône réaliste HC-SR04 sur servo -->
<g transform="translate(150,320)">
<!-- Servo -->
<rect x="-40" y="-10" width="80" height="50" rx="8" fill="#2d3748"/>
<circle cx="0" cy="15" r="20" fill="#e2e8f0" stroke="#2d3748" stroke-width="3"/>
<rect x="-8" y="35" width="16" height="35" fill="#cbd5e0"/>
<!-- HC-SR04 -->
<g transform="translate(0,-45)">
<rect x="-35" y="-25" width="70" height="50" rx="6" fill="#1a202c"/>
<circle cx="-15" cy="-8" r="12" fill="#3182ce"/>
<circle cx="15" cy="-8" r="12" fill="#3182ce"/>
<rect x="-30" y="10" width="60" height="25" rx="4" fill="#2d3748"/>
<text x="0" y="25" fill="#fff" font-size="10">HC-SR04</text>
</g>
</g>
<text x="230" y="400" class="sub">Envoie détection via BLE uniquement</text>
 
  <!-- BLE vers ESP32 #2 -->
<path d="M410,320 Q550,280 750,380" stroke="#4299e1" stroke-width="5" fill="none" marker-end="url(#arrow)" stroke-dasharray="10,5"/>
<rect x="580" y="300" width="90" height="36" rx="18" fill="#4299e1"/>
<text x="625" y="320" fill="white" font-weight="bold">BLE</text>
 
  <!-- ESP32 (2) – Porte d'entrée -->
<rect x="890" y="200" width="360" height="320" class="box"/>
<text x="1070" y="230" class="title">ESP32 #2 – Porte d'entrée</text>
<!-- Keypad réaliste -->
<g transform="translate(1070,300)">
<rect x="-50" y="-60" width="100" height="140" rx="12" fill="#2d3748"/>
<rect x="-40" y="-50" width="80" height="40" rx="6" fill="#1a202c"/>
<rect x="-40" y="-50" width="80" height="40" rx="6" fill="#1a202c"/>
<!-- LCD -->
<rect x="-35" y="-45" width="70" height="25" rx="4" fill="#1ecde0"/>
<!-- Keys -->
<g fill="#e2e8f0" stroke="#a0aec0">
<rect x="-35" y="-5" width="22" height="22" rx="4"/>
<rect x="-10" y="-5" width="22" height="22" rx="4"/>
<rect x="15" y="-5" width="22" height="22" rx="4"/>
<rect x="-35" y="20" width="22" height="22" rx="4"/>
<rect x="-10" y="20" width="22" height="22" rx="4"/>
<rect x="15" y="20" width="22" height="22" rx="4"/>
<rect x="-35" y="45" width="22" height="22" rx="4"/>
<rect x="-10" y="45" width="22" height="22" rx="4"/>
<rect x="15" y="45" width="22" height="22" rx="4"/>
<rect x="-10" y="70" width="47" height="22" rx="4"/>
</g>
</g>
<!-- Verrou électrique -->
<g transform="translate(1070,460)">
<rect x="-45" y="-20" width="90" height="60" rx="10" fill="#ecc94b"/>
<rect x="-25" y="-35" width="50" height="30" rx="6" fill="#f6e05e"/>
<path d="M-15,-35 V-55 A15 15 0 0 1 15 -55 V-35" fill="none" stroke="#2d3748" stroke-width="5"/>
</g>
<text x="1070" y="520" class="sub">Code → MQTT | Déverrouillage ← MQTT</text>
 
  <!-- Photon 2 (1) – Fenêtres + RFID -->
<rect x="50" y="500" width="360" height="260" class="box"/>
<text x="230" y="530" class="title">Photon 2 #1 – Fenêtres & RFID</text>
<!-- 2x Reed switches (fenêtres) -->
<g transform="translate(130,620)">
<rect x="-40" y="-20" width="80" height="40" rx="6" fill="#fff" stroke="#2d3748" stroke-width="3"/>
<rect x="-55" y="-15" width="15" height="30" fill="#e2e8f0" stroke="#2d3748"/>
<rect x="40" y="-15" width="15" height="30" fill="#e2e8f0" stroke="#2d3748"/>
<text x="0" y="35" font-size="12">Reed ×2</text>
</g>
<!-- RFID reader -->
<g transform="translate(280,620)">
<rect x="-40" y="-35" width="80" height="70" rx="10" fill="#2d3748"/>
<circle cx="0" cy="-5" r="25" fill="#3182ce"/>
<path d="M-20,-5 A30 30 0 1 1 20,-5" fill="none" stroke="#fff" stroke-width="4"/>
<path d="M-12,-5 A18 18 0 1 1 12,-5" fill="none" stroke="#fff" stroke-width="3"/>
<text x="0" y="25" fill="#fff" font-size="11">RFID</text>
</g>
 
  <!-- Photon 2 (2) – Alarme sonore & visuelle -->
<rect x="890" y="550" width="360" height="200" class="box"/>
<text x="1070" y="580" class="title">Photon 2 #2 – Alarme</text>
<!-- Buzzer réaliste -->
<g transform="translate(970,670)">
<circle cx="0" cy="0" r="35" fill="#2d3748"/>
<circle cx="0" cy="0" r="28" fill="#e53e3e"/>
<path d="M-50,0 H-35 M50,0 H35" stroke="#fff" stroke-width="6"/>
<circle cx="0" cy="0" r="10" fill="#fff"/>
</g>
<!-- Ampoule -->
<g transform="translate(1150,670)">
<path d="M0,-50 Q-25,-20 -20,0 H20 Q25,-20 0,-50" fill="#f7b731"/>
<path d="M-15,0 H15 V20 H-15 Z" fill="#f6e05e"/>
<rect x="-8" y="20" width="16" height="15" fill="#cbd5e0" rx="3"/>
<text x="0" y="55" font-size="12">Armé = Allumée</text>
</g>
 
  <!-- Connexions MQTT -->
<path d="M410,320 Q600,200 650,190" stroke="#f6ad55" stroke-width="5" fill="none" marker-end="url(#arrow)"/>
<path d="M890,360 Q750,200 650,190" stroke="#f6ad55" stroke-width="5" fill="none" marker-end="url(#arrow)"/>
<path d="M230,500 Q400,400 650,190" stroke="#f6ad55" stroke-width="5" fill="none" marker-end="url(#arrow)"/>
<path d="M1070,550 Q900,450 650,190" stroke="#f6ad55" stroke-width="5" fill="none" marker-end="url(#arrow)"/>
 
  <!-- Légende MQTT -->
<g transform="translate(600,100)">
<rect x="-45" y="-18" width="90" height="36" rx="18" fill="#f6ad55"/>
<text x="0" y="2" fill="white" font-weight="bold">MQTT</text>
</g>
 
  <!-- Note finale -->
<text x="650" y="850" font-size="14" fill="#4a5568" text-anchor="middle">
    BLE = liaison locale (détection présence) • MQTT = tout le reste (états, armement, codes, alarmes)
</text>
</svg>
